{% extends "layout.html" %}
{% block title %}Dashboard - Einsatzplaner{% endblock %}
{% block content %}
{% set is_admin = session.get('is_admin') %}
{% set is_system_admin = is_admin and (current_user and not current_user.department_id) %}
{% set current_user_id = current_user.id if current_user else None %}
<div class="dashboard-page">
  <section class="dashboard-hero">
    <div class="dashboard-hero-main">
      <p class="hero-eyebrow">
        {% if is_system_admin %}
          Systemadministration
        {% elif is_admin %}
          Teamleitung & Planung
        {% else %}
          Mitarbeiterbereich
        {% endif %}
      </p>
      <h1>Hallo {{ current_user.name if current_user else 'Team' }} ğŸ‘‹</h1>
      <p class="hero-subtitle">
        {% if is_admin %}
          Behalte Ressourcen, offene AntrÃ¤ge und die ProduktivitÃ¤t deines Teams im Blick. Von hier aus erreichst du alle wichtigen Tools fÃ¼r eine moderne Einsatzplanung.
        {% else %}
          Dein persÃ¶nliches Cockpit fÃ¼r Schichten, UrlaubsantrÃ¤ge und Team-News. Mit wenigen Klicks bist du vorbereitet auf die kommende Woche.
        {% endif %}
      </p>
      <div class="dashboard-hero-actions">
        <a class="hero-action primary" href="{{ url_for('schedule') }}">
          <span class="hero-action-icon">ğŸ“…</span>
          Dienstplan Ã¶ffnen
        </a>
        {% if is_admin %}
          <a class="hero-action" href="{{ url_for('leave_requests') }}">
            <span class="hero-action-icon">ğŸ“</span>
            AntrÃ¤ge prÃ¼fen
          </a>
        {% else %}
          <a class="hero-action" href="{{ url_for('leave_form') }}">
            <span class="hero-action-icon">ğŸ“</span>
            Urlaub beantragen
          </a>
        {% endif %}
        {% if is_admin %}
          <a class="hero-action" href="{{ url_for('employees') }}">
            <span class="hero-action-icon">ğŸ‘¥</span>
            Team verwalten
          </a>
        {% else %}
          <a class="hero-action" href="{{ url_for('employee_hours_overview') }}">
            <span class="hero-action-icon">â±ï¸</span>
            Meine Stunden
          </a>
        {% endif %}
      </div>
    </div>
    <div class="dashboard-hero-aside">
      <div class="hero-highlight">
        <div class="highlight-icon">âš¡</div>
        <div>
          <p class="highlight-title">NÃ¤chste Schritte</p>
          <p class="highlight-text">
            {% if is_admin %}
              {{ pending_leaves }} offene AbwesenheitsantrÃ¤ge warten auf deine Entscheidung.
            {% else %}
              Checke deinen Einsatzplan und sichere dir rechtzeitig freie Tage.
            {% endif %}
          </p>
        </div>
      </div>
      {% if current_user and current_user.department %}
      <div class="hero-meta-card">
        <p class="meta-label">Meine Abteilung</p>
        <p class="meta-value">{{ current_user.department.name }}</p>
        {% if current_user.department.area %}
        <p class="meta-support">Bereich: {{ current_user.department.area }}</p>
        {% endif %}
      </div>
      {% elif is_system_admin %}
      <div class="hero-meta-card">
        <p class="meta-label">Organisation</p>
        <p class="meta-value">Alle Standorte</p>
        <p class="meta-support">VollstÃ¤ndige SystemÃ¼bersicht aktiv</p>
      </div>
      {% endif %}
    </div>
  </section>

  <section class="dashboard-kpis" aria-label="Kennzahlen">
    <article class="kpi-card kpi-employees">
      <div class="kpi-icon">ğŸ‘¥</div>
      <div class="kpi-content">
        <p class="kpi-label">Aktive Mitarbeitende</p>
        <p class="kpi-value">{{ employee_count }}</p>
        <p class="kpi-helper">
          {% if is_admin %}
            VerfÃ¼gbarkeit & Einsatzbereitschaft im Blick behalten
          {% else %}
            Kolleginnen und Kollegen im aktuellen Team
          {% endif %}
        </p>
      </div>
      {% if is_admin %}
      <a class="kpi-link" href="{{ url_for('employees') }}">Team organisieren â†’</a>
      {% endif %}
    </article>

    <article class="kpi-card kpi-departments">
      <div class="kpi-icon">ğŸ¢</div>
      <div class="kpi-content">
        <p class="kpi-label">
          {% if is_admin %}
            Abteilungen gesamt
          {% else %}
            Einsatzbereich
          {% endif %}
        </p>
        <p class="kpi-value">{{ department_count }}</p>
        <p class="kpi-helper">
          {% if is_admin %}
            Struktur & Verantwortlichkeiten optimal ausbalancieren
          {% else %}
            Ãœberblick Ã¼ber deinen Einsatzkontext
          {% endif %}
        </p>
      </div>
      {% if is_admin %}
      <a class="kpi-link" href="{{ url_for('departments') }}">Bereiche verwalten â†’</a>
      {% else %}
      <a class="kpi-link" href="{{ url_for('employee_profile', emp_id=current_user_id) }}">Profil ansehen â†’</a>
      {% endif %}
    </article>

    <article class="kpi-card kpi-leaves">
      <div class="kpi-icon">ğŸ“‹</div>
      <div class="kpi-content">
        <p class="kpi-label">
          {% if is_admin %}
            Offene AntrÃ¤ge
          {% else %}
            Eigene AntrÃ¤ge
          {% endif %}
        </p>
        <p class="kpi-value">{{ pending_leaves }}</p>
        <p class="kpi-helper">
          {% if is_admin %}
            Koordiniere Urlaube & Abwesenheiten ohne MedienbrÃ¼che
          {% else %}
            Bleibe informiert Ã¼ber den Status deiner Urlaubsplanung
          {% endif %}
        </p>
      </div>
      {% if is_admin %}
      <a class="kpi-link" href="{{ url_for('leave_requests') }}">AntrÃ¤ge bearbeiten â†’</a>
      {% else %}
      <a class="kpi-link" href="{{ url_for('leave_form') }}">Neuen Antrag stellen â†’</a>
      {% endif %}
    </article>
  </section>

  <section class="dashboard-actions" aria-label="Schnellzugriffe">
    {% if is_admin %}
    <article class="action-card">
      <div class="action-icon">ğŸ¤–</div>
      <div class="action-content">
        <h3>Auto-Schichten</h3>
        <p>Erzeuge VorschlÃ¤ge fÃ¼r optimale DienstplÃ¤ne â€“ abgestimmt auf KapazitÃ¤ten und PrioritÃ¤ten.</p>
      </div>
      <a class="action-link" href="{{ url_for('auto_schedule_form') }}">Jetzt planen</a>
    </article>
    <article class="action-card">
      <div class="action-icon">âš™ï¸</div>
      <div class="action-content">
        <h3>ProduktivitÃ¤t steuern</h3>
        <p>Lege Kennzahlen pro Abteilung fest und vergleiche Soll- und Ist-Stunden.</p>
      </div>
      <a class="action-link" href="{{ url_for('productivity_settings') }}">Einstellungen Ã¶ffnen</a>
    </article>
    <article class="action-card">
      <div class="action-icon">ğŸ“ˆ</div>
      <div class="action-content">
        <h3>Monatsreport</h3>
        <p>Auswertungen und Trends fÃ¼r transparente Kommunikation mit Stakeholdern.</p>
      </div>
      <a class="action-link" href="{{ url_for('monthly_report') }}">Bericht ansehen</a>
    </article>
    {% else %}
    <article class="action-card">
      <div class="action-icon">ğŸ—“ï¸</div>
      <div class="action-content">
        <h3>Meine Schichten</h3>
        <p>Plane deine Woche und behalte FrÃ¼h-, SpÃ¤t- und Sonderdienste im Blick.</p>
      </div>
      <a class="action-link" href="{{ url_for('schedule') }}">Zum Dienstplan</a>
    </article>
    <article class="action-card">
      <div class="action-icon">ğŸ–ï¸</div>
      <div class="action-content">
        <h3>Abwesenheit melden</h3>
        <p>Stelle UrlaubsantrÃ¤ge oder informiere dein Team Ã¼ber geplante Abwesenheiten.</p>
      </div>
      <a class="action-link" href="{{ url_for('leave_form') }}">Antrag stellen</a>
    </article>
    <article class="action-card">
      <div class="action-icon">ğŸ’¬</div>
      <div class="action-content">
        <h3>Profil & Kontakt</h3>
        <p>Aktualisiere deine Erreichbarkeit und finde die richtigen Ansprechpartner.</p>
      </div>
      <a class="action-link" href="{{ url_for('employee_profile', emp_id=current_user_id) }}">Profil Ã¶ffnen</a>
    </article>
    {% endif %}
  </section>

  <section class="dashboard-panels">
    <article class="dashboard-panel">
      <header class="panel-header">
        <div>
          <p class="panel-eyebrow">Aktuelles</p>
          <h2>{% if is_admin %}PrioritÃ¤ten heute{% else %}Meine nÃ¤chsten Schritte{% endif %}</h2>
        </div>
      </header>
      <ul class="panel-list">
        <li>
          <span class="status-dot {% if pending_leaves > 0 %}status-warning{% else %}status-success{% endif %}"></span>
          <div>
            <p class="list-title">
              {% if is_admin %}
                Offene Abwesenheiten
              {% else %}
                Urlaubsstatus prÃ¼fen
              {% endif %}
            </p>
            <p class="list-subtitle">
              {% if is_admin %}
                {{ pending_leaves }} AntrÃ¤ge warten auf RÃ¼ckmeldung
              {% else %}
                Bleibe informiert: {{ pending_leaves }} AntrÃ¤ge noch in Bearbeitung
              {% endif %}
            </p>
          </div>
          <a class="panel-link" href="{{ url_for('leave_requests') if is_admin else url_for('leave_form') }}">
            {% if is_admin %}Ansehen{% else %}Status anzeigen{% endif %}
          </a>
        </li>
        <li>
          <span class="status-dot status-info"></span>
          <div>
            <p class="list-title">Dienstplan aktualisieren</p>
            <p class="list-subtitle">
              {% if is_admin %}
                PrÃ¼fe EngpÃ¤sse und gleiche KapazitÃ¤ten Ã¼ber Abteilungen hinweg aus
              {% else %}
                Sichere dir Wunschschichten frÃ¼hzeitig und bleibe flexibel
              {% endif %}
            </p>
          </div>
          <a class="panel-link" href="{{ url_for('schedule') }}">Ã–ffnen</a>
        </li>
        {% if is_admin %}
        <li>
          <span class="status-dot status-neutral"></span>
          <div>
            <p class="list-title">Teamkommunikation</p>
            <p class="list-subtitle">Informiere Kolleg:innen Ã¼ber Ã„nderungen und neue PrioritÃ¤ten</p>
          </div>
          <a class="panel-link" href="{{ url_for('shift_requests_overview') }}">Ãœbersicht</a>
        </li>
        {% else %}
        <li>
          <span class="status-dot status-neutral"></span>
          <div>
            <p class="list-title">Profil aktualisieren</p>
            <p class="list-subtitle">Halte Telefonnummer und bevorzugte Einsatzzeiten aktuell</p>
          </div>
          <a class="panel-link" href="{{ url_for('employee_profile', emp_id=current_user_id) }}">Bearbeiten</a>
        </li>
        {% endif %}
      </ul>
    </article>

    <article class="dashboard-panel accent">
      <header class="panel-header">
        <div>
          <p class="panel-eyebrow">Insights</p>
          <h2>{% if is_admin %}Team & Ressourcen{% else %}Wissenswertes{% endif %}</h2>
        </div>
      </header>
      <div class="insight-grid">
        <div class="insight-card">
          <p class="insight-label">Auslastung</p>
          <p class="insight-value">
            {% if employee_count > 0 %}
              {{ 'Hoch' if pending_leaves / (employee_count or 1) > 0.2 else 'Stabil' }}
            {% else %}
              Keine Daten
            {% endif %}
          </p>
          <p class="insight-text">
            {% if is_admin %}
              Nutze KapazitÃ¤tsdaten, um EngpÃ¤sse frÃ¼hzeitig zu erkennen und gegenzusteuern.
            {% else %}
              Plane Urlaub abgestimmt auf Team-KapazitÃ¤ten fÃ¼r eine faire Verteilung.
            {% endif %}
          </p>
        </div>
        <div class="insight-card">
          <p class="insight-label">Fokus dieser Woche</p>
          <p class="insight-value">{{ 'Planung optimieren' if is_admin else 'Transparente Kommunikation' }}</p>
          <p class="insight-text">
            {% if is_admin %}
              Stimme dich mit Teamleitungen ab und halte Stakeholder mit Berichten auf dem Laufenden.
            {% else %}
              Teile frÃ¼hzeitig VerfÃ¼gbarkeiten und tausche dich mit deinem Team zu Schichten aus.
            {% endif %}
          </p>
        </div>
        <div class="insight-card">
          <p class="insight-label">Tipps</p>
          <p class="insight-value">Proaktiv handeln</p>
          <p class="insight-text">
            {% if is_admin %}
              Nutze Auto-Schichten als Ausgangspunkt und individualisiere EinsÃ¤tze fÃ¼r Spitzenzeiten.
            {% else %}
              PrÃ¼fe den Dienstplan regelmÃ¤ÃŸig, um spontane Ã„nderungen nicht zu verpassen.
            {% endif %}
          </p>
        </div>
      </div>
    </article>
  </section>
</div>
{% endblock %}

