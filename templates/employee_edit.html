{% extends "layout.html" %}
{% block title %}{{ emp.name }} bearbeiten - Dienstplaner{% endblock %}
{% block content %}
<div style="margin-bottom: 2rem;">
  <h1 style="display: flex; align-items: center; margin-bottom: 0.5rem;">
    <span style="margin-right: 0.75rem; font-size: 2rem;">✏️</span>
    {{ emp.name }} bearbeiten
  </h1>
  <p style="color: #64748b; font-size: 1.125rem; margin: 0;">Mitarbeiterdaten aktualisieren und verwalten</p>
</div>

<div class="card">
  <div class="card-header">
    <h3 style="margin: 0; display: flex; align-items: center;">
      <span style="margin-right: 0.75rem;">📝</span>
      Mitarbeiterdaten bearbeiten
    </h3>
  </div>
  <div class="card-body">
    <form method="post">
      <!-- Grunddaten -->
      <div style="margin-bottom: 2rem;">
        <h4 style="color: #374151; margin-bottom: 1rem; display: flex; align-items: center;">
          <span style="margin-right: 0.5rem;">📝</span>Grunddaten
        </h4>
        <div class="row">
          <div class="col-md-4">
            <label for="name" class="form-label">
              <span style="margin-right: 0.5rem;">👤</span>Name *
            </label>
            <input type="text" class="form-control" id="name" name="name" value="{{ emp.name }}" required />
          </div>
          <div class="col-md-4">
            <label for="short_code" class="form-label">
              <span style="margin-right: 0.5rem;">🏷️</span>Kürzel
            </label>
            <input type="text" class="form-control" id="short_code" name="short_code" value="{{ emp.short_code }}" maxlength="10" />
          </div>
          <div class="col-md-4">
            <label for="employee_number" class="form-label">
              <span style="margin-right: 0.5rem;">🔢</span>Personalnummer
            </label>
            <input type="text" class="form-control" id="employee_number" name="employee_number" value="{{ emp.employee_number }}" />
          </div>
        </div>
      </div>

      <!-- Organisatorische Daten -->
      <div style="margin-bottom: 2rem;">
        <h4 style="color: #374151; margin-bottom: 1rem; display: flex; align-items: center;">
          <span style="margin-right: 0.5rem;">🏢</span>Organisation
        </h4>
        <div class="row">
          <div class="col-md-4">
            <label for="department_id" class="form-label">
              <span style="margin-right: 0.5rem;">🏢</span>Abteilung
            </label>
            <select class="form-select" id="department_id" name="department_id">
              <option value="">– Keine Abteilung –</option>
              {% for dept in departments %}
              <option value="{{ dept.id }}"{% if emp.department_id == dept.id %} selected{% endif %}>{{ dept.name }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-4">
            <label for="position" class="form-label">
              <span style="margin-right: 0.5rem;">💼</span>Position
            </label>
            <select class="form-select" id="position" name="position">
              <option value="Vollzeit" {% if emp.position == 'Vollzeit' %}selected{% endif %}>Vollzeit</option>
              <option value="Teilzeit" {% if emp.position == 'Teilzeit' %}selected{% endif %}>Teilzeit</option>
              <option value="Aushilfe" {% if emp.position == 'Aushilfe' %}selected{% endif %}>Aushilfe</option>
            </select>
          </div>
          <div class="col-md-4">
            <label for="monthly_hours" class="form-label">
              <span style="margin-right: 0.5rem;">⏰</span>Monatliche Stunden
            </label>
            <input type="number" min="0" step="0.1" class="form-control" id="monthly_hours" name="monthly_hours" value="{{ emp.monthly_hours }}" />
          </div>
        </div>
        <div class="row">
          <div class="col-md-4">
            <label for="default_daily_hours" class="form-label">
              <span style="margin-right: 0.5rem;">🕐</span>Standard Tagesstunden
            </label>
            <input type="number" min="0" step="0.5" class="form-control" id="default_daily_hours" name="default_daily_hours" value="{{ emp.default_daily_hours }}" placeholder="z.B. 8.0" />
          </div>
          <div class="col-md-8">
            <label class="form-label">
              <span style="margin-right: 0.5rem;">📅</span>Standard Arbeitstage
            </label>
            <div style="display: flex; gap: 1rem; flex-wrap: wrap; padding: 0.5rem 0;">
              {% set work_days = emp.default_work_days.split(',') if emp.default_work_days else [] %}
              <label style="display: flex; align-items: center; cursor: pointer;">
                <input type="checkbox" name="work_days" value="0" {% if '0' in work_days %}checked{% endif %} style="margin-right: 0.5rem;">
                Montag
              </label>
              <label style="display: flex; align-items: center; cursor: pointer;">
                <input type="checkbox" name="work_days" value="1" {% if '1' in work_days %}checked{% endif %} style="margin-right: 0.5rem;">
                Dienstag
              </label>
              <label style="display: flex; align-items: center; cursor: pointer;">
                <input type="checkbox" name="work_days" value="2" {% if '2' in work_days %}checked{% endif %} style="margin-right: 0.5rem;">
                Mittwoch
              </label>
              <label style="display: flex; align-items: center; cursor: pointer;">
                <input type="checkbox" name="work_days" value="3" {% if '3' in work_days %}checked{% endif %} style="margin-right: 0.5rem;">
                Donnerstag
              </label>
              <label style="display: flex; align-items: center; cursor: pointer;">
                <input type="checkbox" name="work_days" value="4" {% if '4' in work_days %}checked{% endif %} style="margin-right: 0.5rem;">
                Freitag
              </label>
              <label style="display: flex; align-items: center; cursor: pointer;">
                <input type="checkbox" name="work_days" value="5" {% if '5' in work_days %}checked{% endif %} style="margin-right: 0.5rem;">
                Samstag
              </label>
              <label style="display: flex; align-items: center; cursor: pointer;">
                <input type="checkbox" name="work_days" value="6" {% if '6' in work_days %}checked{% endif %} style="margin-right: 0.5rem;">
                Sonntag
              </label>
            </div>
          </div>
        </div>
      </div>

      <!-- Kontaktdaten -->
      <div style="margin-bottom: 2rem;">
        <h4 style="color: #374151; margin-bottom: 1rem; display: flex; align-items: center;">
          <span style="margin-right: 0.5rem;">📞</span>Kontakt
        </h4>
        <div class="row">
          <div class="col-md-6">
            <label for="email" class="form-label">
              <span style="margin-right: 0.5rem;">📧</span>E‑Mail
            </label>
            <input type="email" class="form-control" id="email" name="email" value="{{ emp.email or '' }}" />
          </div>
          <div class="col-md-6">
            <label for="phone" class="form-label">
              <span style="margin-right: 0.5rem;">📱</span>Telefon
            </label>
            <input type="text" class="form-control" id="phone" name="phone" value="{{ emp.phone or '' }}" />
          </div>
        </div>
      </div>

      <!-- Systemzugang -->
      <div style="margin-bottom: 2rem;">
        <h4 style="color: #374151; margin-bottom: 1rem; display: flex; align-items: center;">
          <span style="margin-right: 0.5rem;">🔐</span>Systemzugang
        </h4>
        <div class="row">
          <div class="col-md-4">
            <label for="username" class="form-label">
              <span style="margin-right: 0.5rem;">👤</span>Benutzername
            </label>
            <input type="text" class="form-control" id="username" name="username" value="{{ emp.username }}" />
          </div>
          <div class="col-md-4">
            <label for="password" class="form-label">
              <span style="margin-right: 0.5rem;">🔒</span>Neues Passwort
            </label>
            <input type="password" class="form-control" id="password" name="password" placeholder="Leer lassen für keine Änderung" />
          </div>
          {% if session.get('is_admin') %}
          <div class="col-md-4">
            <label class="form-label" style="display: block;">
              <span style="margin-right: 0.5rem;">⚡</span>Berechtigung
            </label>
            <div style="display: flex; align-items: center; padding: 0.75rem 0;">
              <input type="checkbox" id="is_admin" name="is_admin" value="1" {% if emp.is_admin %}checked{% endif %} style="margin-right: 0.5rem; transform: scale(1.2);" />
              <label for="is_admin" style="margin: 0; cursor: pointer; font-weight: 500;">
                Administrator-Rechte
              </label>
            </div>
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Aktionen -->
      <div style="text-align: center; padding-top: 2rem; border-top: 1px solid #e2e8f0; display: flex; gap: 1rem; justify-content: center;">
        <button type="submit" class="btn btn-success" style="padding: 1rem 2rem; font-size: 1.1rem; font-weight: 600;">
          <span style="margin-right: 0.5rem;">💾</span>Änderungen speichern
        </button>
        <a href="{{ url_for('employee_profile', emp_id=emp.id) }}" class="btn btn-secondary" style="padding: 1rem 2rem; font-size: 1.1rem; font-weight: 600;">
          <span style="margin-right: 0.5rem;">❌</span>Abbrechen
        </a>
      </div>
    </form>
  </div>
</div>
{% endblock %}

