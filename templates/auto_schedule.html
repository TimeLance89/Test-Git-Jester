{% extends "layout.html" %}
{% block title %}Automatische Schichtenerstellung - Dienstplaner{% endblock %}
{% block content %}
<div class="auto-schedule-page">
  <div class="auto-page-header">
    <div class="auto-page-icon" aria-hidden="true">🤖</div>
    <div class="auto-page-headline">
      <h1>Automatische Schichtenerstellung</h1>
      <p>Plane komplette Monatspläne in wenigen Klicks – abgestimmt auf Standard-Arbeitszeiten, Positionen oder einzelne Mitarbeitende.</p>
    </div>
  </div>

  <div class="auto-layout">
    <form method="post" action="{{ url_for('create_auto_schedule') }}" class="auto-form">
      <section class="auto-card">
        <header class="auto-card-header">
          <span class="auto-card-icon" aria-hidden="true">📅</span>
          <div>
            <h2>Zeitraum auswählen</h2>
            <p>Bestimme Monat und Jahr für die automatische Schichtenerstellung.</p>
          </div>
        </header>
        <div class="auto-grid">
          <div class="auto-field">
            <label for="month">Monat</label>
            <select class="form-select" id="month" name="month" required>
              <option value="1" {% if current_month == 1 %}selected{% endif %}>Januar</option>
              <option value="2" {% if current_month == 2 %}selected{% endif %}>Februar</option>
              <option value="3" {% if current_month == 3 %}selected{% endif %}>März</option>
              <option value="4" {% if current_month == 4 %}selected{% endif %}>April</option>
              <option value="5" {% if current_month == 5 %}selected{% endif %}>Mai</option>
              <option value="6" {% if current_month == 6 %}selected{% endif %}>Juni</option>
              <option value="7" {% if current_month == 7 %}selected{% endif %}>Juli</option>
              <option value="8" {% if current_month == 8 %}selected{% endif %}>August</option>
              <option value="9" {% if current_month == 9 %}selected{% endif %}>September</option>
              <option value="10" {% if current_month == 10 %}selected{% endif %}>Oktober</option>
              <option value="11" {% if current_month == 11 %}selected{% endif %}>November</option>
              <option value="12" {% if current_month == 12 %}selected{% endif %}>Dezember</option>
            </select>
          </div>
          <div class="auto-field">
            <label for="year">Jahr</label>
            <input type="number" class="form-control" id="year" name="year" value="{{ current_year }}" min="2020" max="2030" required />
          </div>
        </div>
      </section>

      <section class="auto-card">
        <header class="auto-card-header">
          <span class="auto-card-icon" aria-hidden="true">🎯</span>
          <div>
            <h2>Modus wählen</h2>
            <p>Lege fest, ob du für alle Mitarbeitenden, nach Position oder gezielt für eine Person planen möchtest.</p>
          </div>
        </header>
        <div class="mode-grid">
          <label class="mode-card" data-mode="all">
            <input type="radio" name="mode" value="all" checked />
            <div class="mode-card-body">
              <div class="mode-header">
                <span class="mode-icon" aria-hidden="true">👥</span>
                <div>
                  <span class="mode-title">Alle Mitarbeitenden</span>
                  <span class="mode-subtitle">Ideal für eine vollständige Monatsplanung</span>
                </div>
              </div>
              <p class="mode-description">Erstellt automatisch Schichten für alle Mitarbeitenden mit hinterlegten Standard-Arbeitszeiten.</p>
            </div>
          </label>

          <label class="mode-card" data-mode="position"{% if not positions %} data-disabled="true"{% endif %}>
            <input type="radio" name="mode" value="position" {% if not positions %}disabled{% endif %} />
            <div class="mode-card-body">
              <div class="mode-header">
                <span class="mode-icon" aria-hidden="true">🏷️</span>
                <div>
                  <span class="mode-title">Nach Position</span>
                  <span class="mode-subtitle">Fokussiere eine einzelne Rolle</span>
                </div>
              </div>
              <p class="mode-description">Wähle eine Position, um nur für diese Rolle Schichten zu erzeugen.</p>
              <div class="mode-extra" data-mode-field="position">
                {% if positions %}
                  <label for="position" class="visually-hidden">Position auswählen</label>
                  <select class="form-select" name="position" id="position" disabled>
                    <option value="">– Position auswählen –</option>
                    {% for position in positions %}
                      <option value="{{ position }}">{{ position }}</option>
                    {% endfor %}
                  </select>
                {% else %}
                  <div class="mode-empty-hint">Es sind keine Positionen hinterlegt.</div>
                {% endif %}
              </div>
            </div>
          </label>

          <label class="mode-card" data-mode="employee"{% if not employees %} data-disabled="true"{% endif %}>
            <input type="radio" name="mode" value="employee" {% if not employees %}disabled{% endif %} />
            <div class="mode-card-body">
              <div class="mode-header">
                <span class="mode-icon" aria-hidden="true">🧑‍🤝‍🧑</span>
                <div>
                  <span class="mode-title">Einzelner Mitarbeitender</span>
                  <span class="mode-subtitle">Perfekt für individuelle Anpassungen</span>
                </div>
              </div>
              <p class="mode-description">Erzeuge Schichten exklusiv für eine ausgewählte Person.</p>
              <div class="mode-extra" data-mode-field="employee">
                {% if employees %}
                  <label for="employee_id" class="visually-hidden">Mitarbeiter auswählen</label>
                  <select class="form-select" name="employee_id" id="employee_id" disabled>
                    <option value="">– Mitarbeiter auswählen –</option>
                    {% for employee in employees %}
                      <option value="{{ employee.id }}">{{ employee.name }}</option>
                    {% endfor %}
                  </select>
                {% else %}
                  <div class="mode-empty-hint">Es sind keine Mitarbeitenden verfügbar.</div>
                {% endif %}
              </div>
            </div>
          </label>
        </div>
      </section>

      <section class="auto-card">
        <header class="auto-card-header">
          <span class="auto-card-icon" aria-hidden="true">⚙️</span>
          <div>
            <h2>Optionen</h2>
            <p>Nutze die Vorschau, um das Ergebnis vorab zu prüfen.</p>
          </div>
        </header>
        <label class="dry-run-toggle">
          <input type="checkbox" name="dry_run" value="1" />
          <div class="dry-run-content">
            <span class="dry-run-title">Nur Vorschau (Dry Run)</span>
            <span class="dry-run-description">Zeigt an, welche Schichten erstellt würden, ohne sie zu speichern.</span>
          </div>
        </label>
      </section>

      <section class="auto-card auto-card-actions">
        <div class="auto-actions">
          <button type="submit" class="btn btn-success auto-submit">
            <span aria-hidden="true">🚀</span>
            Planung starten
          </button>
          <a href="{{ url_for('schedule') }}" class="btn btn-secondary">
            Abbrechen
          </a>
        </div>
        <p class="auto-actions-hint">Nach dem Start wirst du direkt zum Dienstplan weitergeleitet.</p>
      </section>
    </form>

    <aside class="auto-sidebar">
      <div class="auto-side-card">
        <h3>So funktioniert's</h3>
        <ul>
          <li>Nur freie Tage werden mit neuen Schichten belegt – bestehende Einträge bleiben erhalten.</li>
          <li>Automatisch erzeugte Schichten werden sofort genehmigt.</li>
          <li>Vollzeit-Profile erhalten automatisch 8 Stunden von Montag bis Freitag.</li>
          <li>Nutze die Vorschau, um das Ergebnis vor dem Speichern zu überprüfen.</li>
        </ul>
      </div>
      <div class="auto-side-card info">
        <h3>Tipps für noch bessere Pläne</h3>
        <p>Pflege Standard-Arbeitszeiten und Positionen bei deinen Mitarbeitenden, um die Automatisierung optimal zu nutzen.</p>
      </div>
    </aside>
  </div>
</div>

<script>
  const modeCards = document.querySelectorAll('.mode-card');
  const modeInputs = document.querySelectorAll('input[name="mode"]');

  const updateModeState = () => {
    const activeMode = document.querySelector('input[name="mode"]:checked')?.value;

    modeCards.forEach((card) => {
      const input = card.querySelector('input[type="radio"]');
      if (input.value === activeMode) {
        card.setAttribute('data-active', 'true');
      } else {
        card.removeAttribute('data-active');
      }

      const field = card.querySelector('[data-mode-field] select');
      if (field) {
        field.disabled = input.value !== activeMode || input.disabled;
      }
    });
  };

  modeInputs.forEach((input) => {
    input.addEventListener('change', updateModeState);
  });

  updateModeState();
</script>
{% endblock %}
