{% extends "layout.html" %}
{% block title %}Abwesenheit beantragen - Xerxes{% endblock %}
{% block content %}
<section class="leave-form-page">
  <header class="page-header">
    <div class="page-header-main">
      <span class="page-header-icon" aria-hidden="true">📝</span>
      <div>
        <h1>Abwesenheit beantragen</h1>
        <p>Neuen Urlaubs- oder Abwesenheitsantrag erstellen.</p>
      </div>
    </div>
    <div class="page-header-meta">
      <span class="meta-pill">
        <span class="meta-icon" aria-hidden="true">📆</span>
        Flexible Zeitraumwahl
      </span>
      <span class="meta-pill">
        <span class="meta-icon" aria-hidden="true">🤒</span>
        Krankmeldungen werden automatisch genehmigt
      </span>
    </div>
  </header>

  <div class="leave-form-layout">
    <section class="leave-form-card">
      <header class="leave-form-card-header">
        <div>
          <h2>Dein Antrag</h2>
          <p>Fülle die folgenden Angaben aus, damit wir deinen Antrag zügig bearbeiten können.</p>
        </div>
      </header>

      <form method="post" class="leave-form">
        <section class="leave-form-section" aria-labelledby="leave-section-employee">
          <div class="leave-form-section-heading">
            <span class="leave-form-section-icon" aria-hidden="true">👤</span>
            <div>
              <h3 id="leave-section-employee">Mitarbeiter</h3>
              <p>Wähle, für wen der Antrag eingereicht wird.</p>
            </div>
          </div>

          {% if session.get('is_admin') %}
          <div class="leave-form-grid">
            <div class="leave-form-field">
              <label for="employee_id" class="form-label">Für welchen Mitarbeiter wird der Antrag gestellt? *</label>
              <select class="form-select" id="employee_id" name="employee_id" required>
                {% for emp in employees %}
                <option value="{{ emp.id }}">{{ emp.name }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
          {% else %}
          {% set current_emp = current_employee %}
          <div class="leave-form-readonly">
            <span class="form-label">Antrag für</span>
            <div class="leave-form-readonly-value">{{ current_emp.name }}</div>
            <input type="hidden" name="employee_id" value="{{ current_emp.id }}" />
          </div>
          {% endif %}
        </section>

        <section class="leave-form-section" aria-labelledby="leave-section-period">
          <div class="leave-form-section-heading">
            <span class="leave-form-section-icon" aria-hidden="true">📅</span>
            <div>
              <h3 id="leave-section-period">Zeitraum</h3>
              <p>Definiere Start- und Enddatum deiner Abwesenheit.</p>
            </div>
          </div>

          <div class="leave-form-grid">
            <div class="leave-form-field">
              <label for="start_date" class="form-label">Startdatum *</label>
              <input type="date" class="form-control" id="start_date" name="start_date" required />
            </div>
            <div class="leave-form-field">
              <label for="end_date" class="form-label">Enddatum *</label>
              <input type="date" class="form-control" id="end_date" name="end_date" required />
            </div>
          </div>
        </section>

        <section class="leave-form-section" aria-labelledby="leave-section-type">
          <div class="leave-form-section-heading">
            <span class="leave-form-section-icon" aria-hidden="true">🏷️</span>
            <div>
              <h3 id="leave-section-type">Art der Abwesenheit</h3>
              <p>Wähle den passenden Typ für deinen Antrag.</p>
            </div>
          </div>

          <div class="leave-form-grid">
            <div class="leave-form-field">
              <label for="leave_type" class="form-label">Typ *</label>
              <select class="form-select" id="leave_type" name="leave_type" required>
                <option value="Urlaub">🏖️ Urlaub</option>
                <option value="Krank">🤒 Krank</option>
                <option value="ÜSA">⏰ ÜSA (Überstundenabbau)</option>
              </select>
            </div>
          </div>
        </section>

        <section class="leave-form-section" aria-labelledby="leave-section-notes">
          <div class="leave-form-section-heading">
            <span class="leave-form-section-icon" aria-hidden="true">💬</span>
            <div>
              <h3 id="leave-section-notes">Zusätzliche Informationen</h3>
              <p>Optional: Teile uns weitere Details zu deinem Antrag mit.</p>
            </div>
          </div>

          <div class="leave-form-field">
            <label for="notes" class="form-label">Bemerkung</label>
            <textarea
              class="form-control"
              id="notes"
              name="notes"
              rows="4"
              placeholder="Zusätzliche Informationen zum Antrag..."
            ></textarea>
          </div>
        </section>

        <div class="leave-form-actions">
          <button type="submit" class="btn btn-success">
            <span aria-hidden="true">📤</span>
            Antrag einreichen
          </button>
          <a href="{{ url_for('leave_requests') if session.get('is_admin') else url_for('schedule') }}" class="btn btn-outline-secondary">
            <span aria-hidden="true">↩️</span>
            Abbrechen
          </a>
        </div>
      </form>
    </section>

    <aside class="leave-form-aside">
      <div class="info-card leave-form-info">
        <h3>Tipps für einen reibungslosen Ablauf</h3>
        <ul class="info-list">
          <li><span class="info-icon" aria-hidden="true">⏱️</span> Reiche Urlaubsanträge möglichst frühzeitig ein, damit dein Team planen kann.</li>
          <li><span class="info-icon" aria-hidden="true">📝</span> Nutze das Kommentarfeld für Hinweise zu Vertretungen oder Teilabwesenheiten.</li>
          <li><span class="info-icon" aria-hidden="true">📧</span> Du wirst automatisch informiert, sobald dein Antrag bearbeitet wurde.</li>
        </ul>
      </div>

      {% if not session.get('is_admin') %}
      <div class="info-card info-card--subtle">
        <h3>Wer sieht deinen Antrag?</h3>
        <p>Dein zuständiger Abteilungsleiter wird automatisch benachrichtigt und kann den Antrag genehmigen oder ablehnen.</p>
      </div>
      {% else %}
      <div class="info-card info-card--subtle">
        <h3>Schnellzugriff für Admins</h3>
        <p>Nutze die Übersicht der <a href="{{ url_for('leave_requests') }}">Abwesenheitsanträge</a>, um neue Einreichungen direkt zu prüfen.</p>
      </div>
      {% endif %}
    </aside>
  </div>
</section>

<script>
  const startDateInput = document.getElementById('start_date');
  const endDateInput = document.getElementById('end_date');

  if (startDateInput && endDateInput) {
    startDateInput.addEventListener('change', () => {
      if (!endDateInput.value) {
        endDateInput.value = startDateInput.value;
      }
    });

    endDateInput.addEventListener('change', () => {
      const startValue = startDateInput.value;
      if (startValue && endDateInput.value < startValue) {
        alert('Das Enddatum muss nach dem Startdatum liegen.');
        endDateInput.value = startValue;
      }
    });
  }
</script>
{% endblock %}
